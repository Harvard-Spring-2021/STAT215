---
title: "Harvard Stat 115/215 HW 1"
author: "Your Name"
date: "Date"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Finding the Stat 115 directory 
Once you log in to Cannon, type `cd /n/stat115` to go to the Stat 115 directory. This folder contains all of the data needed to complete this assignment. 

### Problem 1: STAR alignment

We will give you a simple example to test high throughput sequencing alignment for RNA-seq data. Normally for paired-end sequencing data, each sample will have two separate FASTQ files, with line-by-line correspondence to the two reads from the same fragment. Read mapping could take a long time, so we have created just two FASTQ files of one RNA-seq sample with only 30,000 fragments (2 * 30,000 reads) for you to run STAR instead of the full data. The files are located at /2021/HW1/raw_data1. The mapping will generate one single output file. 

**Use STAR (Dobin et al, Bioinformatics 2012) to map the reads to the reference genome, available on Cannon at /2021/HW1/index/star_hg38_index. Use the paired-end alignment mode and generate the output in SAM format. Please include full STAR report. How many reads are mappable and how many are uniquely mappable?**

```
Sequencing data:
/2021/HW1/raw_data1

module: STAR/2.6.0c-fasrc01 
index: /2021/HW1/index/star_hg38_index
```

```{r q1, engine="bash", eval = FALSE}
# your bash code here
```


### Problem 2: RNA-seq quality control 

You are asked by a collaborator to analyze four RNA-seq libraries. She suspects that the libraries are generally of high-quality but is concerned that a sample may have been switched with her benchmates during processing. To save time, we have provided four bam files generated by STAR in /2021/HW1/raw_data2.  

**Please use RSeQC (Liguo Wang et al, Bioinformatics 2012) geneBody_coverage.py and tin.py modules to determine whether any of the samples exhibit unusual quality control metrics. To expedite the process, you can use housekeeping genes as reference, which provided in /2021/HW1/raw_data2. Overall, identify the best and worst libraries. Your answer should include screen shots and tables as necessary as if you were delivering a report to the collaborator.**
```
data:
/2021/HW1/raw_data2/bamFile
```

```{r q2, engine="bash", eval = FALSE}
# your bash code here
```


### Problem 3: Python programming

**One output file of RSeQC is called geneBodyCoverage.txt which contains normalized reads mapped to each % of gene / transcript body. Suppose that we want to visualize all 4 samples together to quickly perform quality control. Write a python program to extract the values and name from each file. The same script should then draw the gene body coverage for all the samples (2 rows x 2 cols) in one figure. We provide an example with 3 x 2 samples in one figure. Please identify the worst sample by your result.**

```{r q3}
# your python code here
```


### Problem 4: RNA-seq quantification

Transcript quantification plays an important role in the analysis of RNA-seq data. A large number of tools have been developed to quantify expression at the transcript level. RSEM (Bo Li et al, BMC Bioinformatics 2011) is a software package for estimating gene and isoform expression levels from single-end or paired-end RNA-Seq data, it can perform the alignment step with three different aligners: bowtie, bowtie2, or STAR. Salmon (Rob Patro et al, Nature Methods 2017) is an ultra-fast alignment-free method which also can correct for GC-bias.

**Please run STAR+RSEM and Salmon on one good quality sample from problem 2 and 3 to get FPKM and TPM. Identify the transcript and gene with the highest expression in this library from the Salmon output. **

```
data: /2021/HW1/raw_data2/
module: STAR/2.6.0c-fasrc01, rsem/1.2.29-fasrc03, salmon/0.12.0-fasrc01
index: /2021/HW1/index/salmon_hg38_index,/2021/HW1/index/rsem_hg38_index
```
```{r q4, engine="bash"}
# your bash code here
```


### Problem 5: Speed Comparison

**Report the relative speed of STAR+RSEM and Salmon for the analyses of the sample. Comment on your results based on the lecture material.**


### Problem 6: 

**Plot the relationship between effective length, normalized read counts, TPM, and FPKM for this sample from the RSEM and Salmon output. Comment on the relative utility of each metric when analyzing gene expression data.**

```{r q6}
# your R code here
```